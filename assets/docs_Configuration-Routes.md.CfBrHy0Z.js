import{_ as a,c as i,o as t,ah as s}from"./chunks/framework.C9w-46Qr.js";const u=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"docs/Configuration-Routes.md","filePath":"docs/Configuration-Routes.md"}'),n={name:"docs/Configuration-Routes.md"};function o(r,e,l,h,p,d){return t(),i("div",null,[...e[0]||(e[0]=[s(`<p>You can specify routes for your upstream servers in the OAG configuration</p><p>Example:</p><div class="language-yaml"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">routes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  route1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">webapplication</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    path</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/myservice/**</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    url</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">https://backend.my/</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    allowAnonymous</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">yes</span></span></code></pre></div><h2 id="configuration" tabindex="-1">Configuration <a class="header-anchor" href="#configuration" aria-label="Permalink to “Configuration”">​</a></h2><h3 id="name-route1" tabindex="-1">name -&gt; route1 <a class="header-anchor" href="#name-route1" aria-label="Permalink to “name -&gt; route1”">​</a></h3><p>You can specify multiple routes under the <code>routes</code> property. You must specify a unique name for each route (in the example above this is route1). It is recommended to use something meaningful like frontend, backend, or the name of the service.</p><h3 id="type" tabindex="-1"><code>type</code> <a class="header-anchor" href="#type" aria-label="Permalink to “type”">​</a></h3><p>The type property specifies the name of the <a href="https://github.com/gianlucafrei/nellygateway/wiki/Configuration:-SecurityProfiles" target="_blank" rel="noreferrer">Security Profile</a> that is used for this route. You must set a valid security profile, you can either use a default one or define your own security profile.</p><h3 id="path" tabindex="-1"><code>path</code> <a class="header-anchor" href="#path" aria-label="Permalink to “path”">​</a></h3><p>The path setting specifies which requests to OAG are routed with this route. In the upper example all requests to <code>/myservice</code> are routes to <code>https://backend.my/</code>. You can use ant-style patterns for routes:</p><ul><li><code>/myservice/</code> matches only <code>/myservice/</code></li><li><code>/myservice/*</code> matches with one level wildcard, i.e. <code>/myservice/foo</code></li><li><code>/myservice/**</code> matches all hierarchical request, i.e. <code>/myservice/foo/bar</code></li></ul><h3 id="url" tabindex="-1"><code>url</code> <a class="header-anchor" href="#url" aria-label="Permalink to “url”">​</a></h3><p>The URL setting specifies the downstream service to which OAG forwards the request. The path from the route will not be forwarded. For instance, if you call with the example before <code>/myservice/foo</code> OAG forwards the request to <code>https://backend.my/foo</code>.</p><h3 id="allowanonymous" tabindex="-1"><code>allowAnonymous</code> <a class="header-anchor" href="#allowanonymous" aria-label="Permalink to “allowAnonymous”">​</a></h3><p>Boolean variable: If you specify <code>no</code> OAG only allows authenticated requests to this route. This setting is useful if your backend application expects only authenticated users. Another use case for this option is if you want to secure a web service that has no authentication implemented. This method is then only secure if you specify only Login provider from private IdPs and not social logins.</p><h3 id="rewrite-optional" tabindex="-1"><code>rewrite</code> (optional) <a class="header-anchor" href="#rewrite-optional" aria-label="Permalink to “rewrite (optional)”">​</a></h3><p>The default rewrite behavior is designed to be intuitive. This is why it strips the heading path segments when wildcards are used. i:e. <code>/api/endpoint</code> is rewritten to <code>https://backend/endpoint</code> if the route path is <code>/api/**</code> and the route url is <code>https://backend/</code>. This is because most of the time a backend api is only interested in relevant api endpoint and not the full path. If the backend server needs the &quot;api&quot; part in the url the route url can simply be set to <code>https://backend/api/</code>, then the request would get forwarded to with the original path <code>https://backend/api/endpoint</code>.</p><p>We expect that this behavior is good enough and intuitive to understand for most use cases. However, if you want to implement more complex rewrite behavior you can use arbitrary regex and replacement strings.</p><p>With the rewrite configuration you can overwrite the default path rewrite behavior of OAG.</p><ul><li><code>regex</code> Regex that matches the route and might extract relevant path segments</li><li><code>replacement</code> Replacement string that can use defines path segments</li></ul><p>Internally the regex and replacement is processed by the Spring Cloud Gateway with the Java String replaceAll method. See snippet bellow:</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">String path </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> req.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getURI</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getRawPath</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">String newPath </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> path.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">replaceAll</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(config.regexp, replacement);</span></span></code></pre></div><h4 id="default-rewrite-behaviour-detailed" tabindex="-1">Default Rewrite Behaviour (Detailed) <a class="header-anchor" href="#default-rewrite-behaviour-detailed" aria-label="Permalink to “Default Rewrite Behaviour (Detailed)”">​</a></h4><p>If no rewrite configuration is defined the following default configuration is used:</p><ul><li><code>regex</code>: <code>&lt;route-path-base&gt;(?&lt;segment&gt;.*)</code> whereas &lt;route-path-base&gt; is the path of the route without trailing wildcards</li><li><code>replacement</code>: <code>&lt;route-uri-path&gt;\${segment}</code> whereas &lt;route-uri-path&gt; is the path of the defined url for this route with a trailing slash</li></ul><p>This leads to the following default behavior:</p><h5 id="example-1" tabindex="-1">Example 1 <a class="header-anchor" href="#example-1" aria-label="Permalink to “Example 1”">​</a></h5><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>Route Path:                   /api/**</span></span>
<span class="line"><span>Route Url:                    http://localhost:7777/</span></span>
<span class="line"><span>Request Path:                 /api/messages/123</span></span>
<span class="line"><span>Resulting downstream request: http://localhost:7777/messages/123</span></span></code></pre></div><h5 id="example-2" tabindex="-1">Example 2 <a class="header-anchor" href="#example-2" aria-label="Permalink to “Example 2”">​</a></h5><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>Route Path:                   /rewrite1/**</span></span>
<span class="line"><span>Route Url:                    http://localhost:7777/rewritten/</span></span>
<span class="line"><span>Request Path:                 /rewrite1/message.txt</span></span>
<span class="line"><span>Resulting downstream request: http://localhost:7777/rewritten/message.txt</span></span></code></pre></div>`,30)])])}const k=a(n,[["render",o]]);export{u as __pageData,k as default};
