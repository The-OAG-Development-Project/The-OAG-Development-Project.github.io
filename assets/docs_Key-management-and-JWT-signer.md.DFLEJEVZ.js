import{_ as i,c as s,o as a,ah as n}from"./chunks/framework.C9w-46Qr.js";const g=JSON.parse('{"title":"Key management and JWT signer","description":"","frontmatter":{},"headers":[],"relativePath":"docs/Key-management-and-JWT-signer.md","filePath":"docs/Key-management-and-JWT-signer.md"}'),t={name:"docs/Key-management-and-JWT-signer.md"};function l(r,e,o,h,p,d){return a(),s("div",null,[...e[0]||(e[0]=[n(`<h1 id="key-management-and-jwt-signer" tabindex="-1">Key management and JWT signer <a class="header-anchor" href="#key-management-and-jwt-signer" aria-label="Permalink to “Key management and JWT signer”">​</a></h1><h2 id="key-management-configuration" tabindex="-1">Key management configuration <a class="header-anchor" href="#key-management-configuration" aria-label="Permalink to “Key management configuration”">​</a></h2><p>This is a top level configuration element.</p><div class="language-yaml"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">keyManagementProfile</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  keyRotationProfile</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">defaultKeyRotation</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    useSigningKeyRotation</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    signingKeyRotationSeconds</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">28800</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    cleanupFrequencySeconds</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10000</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  jwkStoreProfile</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">localRsaJwkStore</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    implSpecificSettings</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      exampleParameter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;not used&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  keyGeneratorProfile</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">rsaKeyGenerator</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    keySize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4096</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    implSpecificSettings</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      exampleParameter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;not used&quot;</span></span></code></pre></div><p><strong>keyRotationProfile part</strong></p><ul><li><code>type</code>: Defines the key rotation strategy. Currently supported: &#39;defaultKeyRotation&#39;.</li><li><code>useSigningKeyRotation</code>: Set to true to automatically generate a new key from time to time (recommended). Set this to false to always keep the key generated at startup.</li><li><code>signingKeyRotationSeconds</code>: Rotate the signing key after that many seconds.</li><li><code>cleanupFrequencySeconds</code>: Run memory clean-up of expired signing keys after that many seconds. (Note that signing keys have a grace period during which they are still served when requested anyway built-in.)</li></ul><p><strong>jwkStoreProfile part</strong></p><ul><li><code>type</code>: Defines what type of keys the signing key store can hold. Currently supported: <code>localRsaJwkStore</code>.</li><li><code>implSpecificSettings</code>: Key/value pairs required by the store implementation selected above. <code>localRsaJwkStore</code> needs none.</li></ul><p><strong>keyGeneratorProfile part</strong></p><ul><li><code>type</code>: The key generator to use. Currently supported: <code>rsaKeyGenerator</code>.</li><li><code>keySize</code>: The number of bits for generated keys.</li><li><code>implSpecificSettings</code>: key generator impl specific settings. <code>rsaKeyGenerator</code> requires no additional settings.</li></ul><h3 id="key-rotation-implementations" tabindex="-1">key rotation implementations <a class="header-anchor" href="#key-rotation-implementations" aria-label="Permalink to “key rotation implementations”">​</a></h3><h4 id="defaultkeyrotation" tabindex="-1"><code>defaultKeyRotation</code> <a class="header-anchor" href="#defaultkeyrotation" aria-label="Permalink to “defaultKeyRotation”">​</a></h4><p>Implements a key rotation scheme that uses the configured keyGenerator to generate new keys and make them available in the configured jwkStore. Makes sure that on startup a new signing key is generated. Updates also the currentSigningKeyHolder with the new key. Heeds the standard configuration settings and does not require any <code>implSpecificSettings</code>.</p><h3 id="jwkstore-implementations" tabindex="-1">jwkStore implementations <a class="header-anchor" href="#jwkstore-implementations" aria-label="Permalink to “jwkStore implementations”">​</a></h3><h4 id="localrsajwkstore" tabindex="-1"><code>localRsaJwkStore</code> <a class="header-anchor" href="#localrsajwkstore" aria-label="Permalink to “localRsaJwkStore”">​</a></h4><p>Stores signing keys as long as they are valid (plus a grace time of 10 minutes) in memory and local only. Does not require any <code>implSpecificSettings</code>.</p><h3 id="key-generator-implementations" tabindex="-1">key generator implementations <a class="header-anchor" href="#key-generator-implementations" aria-label="Permalink to “key generator implementations”">​</a></h3><h4 id="rsakeygenerator" tabindex="-1"><code>rsaKeyGenerator</code> <a class="header-anchor" href="#rsakeygenerator" aria-label="Permalink to “rsaKeyGenerator”">​</a></h4><p>Generates RSA keys. Does not require any <code>implSpecificSettings</code>.</p><h2 id="jwt-signer" tabindex="-1">Jwt signer <a class="header-anchor" href="#jwt-signer" aria-label="Permalink to “Jwt signer”">​</a></h2><p>The key signer used for a JWT passed to downstream system is configured in the security profile assigned to a route and only available for &#39;jwtToken&#39;.</p><div class="language-yaml"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">userMapping</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;jwtToken&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      settings</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # ...</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        signatureImplementation</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;rsa&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        signatureSettings</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span></code></pre></div><p><strong>relevant settings part</strong></p><ul><li><code>signatureImplementation</code>: The signature implementation to use. Currently supported: <code>rsa</code>, <code>hmac</code> (not recommended).</li><li><code>signatureSettings</code>: signature implementation specific settings. <code>rsa</code> requires none.</li></ul><h3 id="jwt-signers-signatureimplementation" tabindex="-1">jwt signers (<code>signatureImplementation</code>) <a class="header-anchor" href="#jwt-signers-signatureimplementation" aria-label="Permalink to “jwt signers (signatureImplementation)”">​</a></h3><h4 id="rsa" tabindex="-1"><code>rsa</code> <a class="header-anchor" href="#rsa" aria-label="Permalink to “rsa”">​</a></h4><p>Implements RS256 JWT signature based on automatically generated (zero-config) keys as implemented by the key rotation configuration. Adds kid and jku headers to the JWT. Does not need any configuration settings.</p><h4 id="hmac-not-recommended" tabindex="-1"><code>hmac</code> (not recommended) <a class="header-anchor" href="#hmac-not-recommended" aria-label="Permalink to “hmac (not recommended)”">​</a></h4><p>Implements HS256, HS385, HS512 (derived from key size) JWT signatures. Adds kid header, but naturally no jku header to the JWT. Requires these <code>signatureSettings</code>:</p><div class="language-yaml"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">...</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  signatureSettings</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    keyId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;myKeyId&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    secretKey</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;546573744b6579546573744b6579546573744b6579546573744b657....9&quot;</span></span></code></pre></div><p><strong>signatureSettings part</strong></p><ul><li><code>keyId</code>: The kid to be put in the JWT header.</li><li><code>secretKey</code>: The hey encoded shared key used for signing the JWT. Depending on its length HS256 (for 256-bit key), HS348 or HS512 is automatically used.</li></ul><div class="warning custom-block"><p class="custom-block-title custom-block-title-default">WARNING</p><p>Beware that the jwkStore, the keyGenerator as well as the jwtSigner used depend on each other! So if you use an RSA based JWT signer, you also need an RSA based jwkStore and keyGenerator. The keyRotation implementation is independent and relies on jwkStore and keyGenerator only.</p></div>`,33)])])}const c=i(t,[["render",l]]);export{g as __pageData,c as default};
