<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Validating user identity | OWASP-Application-Gateway</title>
    <meta name="generator" content="VuePress 1.9.10">
    
    <meta name="description" content="OWASP Application Gateway is an HTTP proxy that handles Oauth2 authentication and session management">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/assets/css/0.styles.d74e1dbf.css" as="style"><link rel="preload" href="/assets/js/app.80938ac1.js" as="script"><link rel="preload" href="/assets/js/2.699db687.js" as="script"><link rel="preload" href="/assets/js/1.6f7f3e11.js" as="script"><link rel="preload" href="/assets/js/46.33739bdd.js" as="script"><link rel="prefetch" href="/assets/js/10.bc770b30.js"><link rel="prefetch" href="/assets/js/11.4eb6f50c.js"><link rel="prefetch" href="/assets/js/12.a4dadbb2.js"><link rel="prefetch" href="/assets/js/13.2997afc4.js"><link rel="prefetch" href="/assets/js/14.353d6eef.js"><link rel="prefetch" href="/assets/js/15.7e8a42c3.js"><link rel="prefetch" href="/assets/js/16.080d0551.js"><link rel="prefetch" href="/assets/js/17.68d7fb70.js"><link rel="prefetch" href="/assets/js/18.fc93894c.js"><link rel="prefetch" href="/assets/js/19.59a8dd5e.js"><link rel="prefetch" href="/assets/js/20.a728a170.js"><link rel="prefetch" href="/assets/js/21.8f6f4046.js"><link rel="prefetch" href="/assets/js/22.4d277477.js"><link rel="prefetch" href="/assets/js/23.7fb60023.js"><link rel="prefetch" href="/assets/js/24.45dce4ba.js"><link rel="prefetch" href="/assets/js/25.25e30095.js"><link rel="prefetch" href="/assets/js/26.d7867109.js"><link rel="prefetch" href="/assets/js/27.fc8464e5.js"><link rel="prefetch" href="/assets/js/28.a821b188.js"><link rel="prefetch" href="/assets/js/29.1bebf4e2.js"><link rel="prefetch" href="/assets/js/3.391fe791.js"><link rel="prefetch" href="/assets/js/30.f2a2d9c6.js"><link rel="prefetch" href="/assets/js/31.e56495af.js"><link rel="prefetch" href="/assets/js/32.a346b474.js"><link rel="prefetch" href="/assets/js/33.ce475055.js"><link rel="prefetch" href="/assets/js/34.413e29a9.js"><link rel="prefetch" href="/assets/js/35.839fa239.js"><link rel="prefetch" href="/assets/js/36.4db4be0e.js"><link rel="prefetch" href="/assets/js/37.16727742.js"><link rel="prefetch" href="/assets/js/38.a0654948.js"><link rel="prefetch" href="/assets/js/39.69f3981a.js"><link rel="prefetch" href="/assets/js/4.a04ccb9d.js"><link rel="prefetch" href="/assets/js/40.89464b71.js"><link rel="prefetch" href="/assets/js/41.3ffac7cc.js"><link rel="prefetch" href="/assets/js/42.48489876.js"><link rel="prefetch" href="/assets/js/43.9e42117c.js"><link rel="prefetch" href="/assets/js/44.f0191db4.js"><link rel="prefetch" href="/assets/js/45.b77db7cb.js"><link rel="prefetch" href="/assets/js/47.8bf52a09.js"><link rel="prefetch" href="/assets/js/48.3f9b93b9.js"><link rel="prefetch" href="/assets/js/5.4aba4ca2.js"><link rel="prefetch" href="/assets/js/6.c3403115.js"><link rel="prefetch" href="/assets/js/7.6acff8ff.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.aae61d50.js">
    <link rel="stylesheet" href="/assets/css/0.styles.d74e1dbf.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">OWASP-Application-Gateway</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/docs/" class="nav-link router-link-active">
  Documentation
</a></div><div class="nav-item"><a href="https://app.swaggerhub.com/apis-docs/gianlucafrei/OAG/0.4#/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Swagger
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://owasp.org/www-project-application-gateway/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  OWASP
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/The-OAG-Development-Project/Application-Gateway/" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/docs/" class="nav-link router-link-active">
  Documentation
</a></div><div class="nav-item"><a href="https://app.swaggerhub.com/apis-docs/gianlucafrei/OAG/0.4#/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Swagger
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://owasp.org/www-project-application-gateway/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  OWASP
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/The-OAG-Development-Project/Application-Gateway/" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Getting Started</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/" aria-current="page" class="sidebar-link">Introduction</a></li><li><a href="/docs/Terms-you-need-to-understand.html" class="sidebar-link">Terms you need to understand</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Configuration</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Custom code extensions</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>OAG API endpoints</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Integrating with OAG</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/Integrating-with-OAG.html" class="sidebar-link">Overview</a></li><li><a href="/docs/Validating-user-identity.html" aria-current="page" class="active sidebar-link">Validating user identity</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/Validating-user-identity.html#signed-jwt-issued-by-oag-recommended" class="sidebar-link">Signed JWT issued by OAG (recommended)</a></li><li class="sidebar-sub-header"><a href="/docs/Validating-user-identity.html#forwarded-jwt-of-the-original-authentication-server-oidc-server-recommended-only-when-oidc-server-is-owned-by-your-company-project-and-the-only-one" class="sidebar-link">Forwarded JWT of the original authentication server (OIDC server) (recommended only when OIDC server is owned by your company/project and the only one)</a></li><li class="sidebar-sub-header"><a href="/docs/Validating-user-identity.html#header-fields-with-user-data-not-recommended-for-legacy-integration-only" class="sidebar-link">Header fields with user data (not recommended, for legacy integration only)</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>How To's</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="validating-user-identity"><a href="#validating-user-identity" class="header-anchor">#</a> Validating user identity</h1> <p>OAG forwards the identity of the user according to its configuration in one of the following ways: <br></p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>See <a href="/docs/Configuration-User-Mapping">Configure User mapping</a> for details on how to configure these options.</p></div> <h2 id="signed-jwt-issued-by-oag-recommended"><a href="#signed-jwt-issued-by-oag-recommended" class="header-anchor">#</a> Signed JWT issued by OAG (recommended)</h2> <p>Most important is proper signature validation. For this you need the public key matching OAG's signing key. It is up to you how you make this key available to your application (e.g. within a keystore, using JWKS of OAG, providing BASE64 encoded in a config file, etc.). The recommended way is to use OAGs <a href="/docs/JWKS-JWT-signing-public-keys-of-OAG">JWKS endpoint</a>. If you take that route consider the following as the minimal verification your application should do after receiving the OAG Token (JWT):</p> <ol><li>From the configured header sent by OAG extract the ID Token and read of the ID Token:
<ul><li>kid -&gt; the id of the key used to sign the Token</li> <li>jku -&gt; The url where the JWKS endpoint of OAG is published</li></ul></li> <li>verify that jku points to a trusted / known domain (i.e. https://&lt;jourknownhost.domain&gt;:&lt;port&gt;/)</li> <li>load the keys from jku and extract the key matching kid -&gt; this is the signing public key, SPK.</li></ol> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Make sure you enable proper TLS hostname verification and use a truststore with minimal trusted CA certificates when establishing the https connection. Alternativile you can also use jku/kid to request the JWK with kid directly.</p></div> <ol start="4"><li>Verify the signature of the Token with SPK according to <a href="https://tools.ietf.org/html/rfc7515" target="_blank" rel="noopener noreferrer">RFC 7515<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>Verify the issuer (OAG, as configured)</li> <li>Verify the audience (aud claim should be as configured and expected from your application)</li> <li>verify the JWT according to your needs (See also: <a href="https://openid.net/specs/openid-connect-core-1_0.html" target="_blank" rel="noopener noreferrer">OIDC<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> and <a href="https://datatracker.ietf.org/doc/html/rfc7519" target="_blank" rel="noopener noreferrer">RFC7519<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>). At least this should include:
<ul><li>exp -&gt; not expired</li> <li>jti -&gt; when you do not expect repeated calls with the same token, or to check for tokens marked as &quot;invalid&quot;</li> <li>sub -&gt; The user is granted access to the requested resource/action</li></ul></li></ol> <h2 id="forwarded-jwt-of-the-original-authentication-server-oidc-server-recommended-only-when-oidc-server-is-owned-by-your-company-project-and-the-only-one"><a href="#forwarded-jwt-of-the-original-authentication-server-oidc-server-recommended-only-when-oidc-server-is-owned-by-your-company-project-and-the-only-one" class="header-anchor">#</a> Forwarded JWT of the original authentication server (OIDC server) (recommended only when OIDC server is owned by your company/project and the only one)</h2> <p>Verify the forwarded JWT/Access Token as specified by the OIDC server / authentication server.</p> <h2 id="header-fields-with-user-data-not-recommended-for-legacy-integration-only"><a href="#header-fields-with-user-data-not-recommended-for-legacy-integration-only" class="header-anchor">#</a> Header fields with user data (not recommended, for legacy integration only)</h2> <p>Verify the headers according to your needs and custom security concept.</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/docs/Integrating-with-OAG.html" class="prev">
        Overview
      </a></span> <span class="next"><a href="/docs/HowTo-Deploy-OAG-on-Azure-App-Service.html">
        Deploy OAG on Azure App Service
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.80938ac1.js" defer></script><script src="/assets/js/2.699db687.js" defer></script><script src="/assets/js/1.6f7f3e11.js" defer></script><script src="/assets/js/46.33739bdd.js" defer></script>
  </body>
</html>
