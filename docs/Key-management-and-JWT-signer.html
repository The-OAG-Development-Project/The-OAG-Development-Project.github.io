<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Key management and JWT signer | OWASP-Application-Gateway</title>
    <meta name="generator" content="VuePress 1.9.10">
    
    <meta name="description" content="OWASP Application Gateway is an HTTP proxy that handles Oauth2 authentication and session management">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/assets/css/0.styles.d74e1dbf.css" as="style"><link rel="preload" href="/assets/js/app.80938ac1.js" as="script"><link rel="preload" href="/assets/js/2.699db687.js" as="script"><link rel="preload" href="/assets/js/1.6f7f3e11.js" as="script"><link rel="preload" href="/assets/js/38.a0654948.js" as="script"><link rel="prefetch" href="/assets/js/10.bc770b30.js"><link rel="prefetch" href="/assets/js/11.4eb6f50c.js"><link rel="prefetch" href="/assets/js/12.a4dadbb2.js"><link rel="prefetch" href="/assets/js/13.2997afc4.js"><link rel="prefetch" href="/assets/js/14.353d6eef.js"><link rel="prefetch" href="/assets/js/15.7e8a42c3.js"><link rel="prefetch" href="/assets/js/16.080d0551.js"><link rel="prefetch" href="/assets/js/17.68d7fb70.js"><link rel="prefetch" href="/assets/js/18.fc93894c.js"><link rel="prefetch" href="/assets/js/19.59a8dd5e.js"><link rel="prefetch" href="/assets/js/20.a728a170.js"><link rel="prefetch" href="/assets/js/21.8f6f4046.js"><link rel="prefetch" href="/assets/js/22.4d277477.js"><link rel="prefetch" href="/assets/js/23.7fb60023.js"><link rel="prefetch" href="/assets/js/24.45dce4ba.js"><link rel="prefetch" href="/assets/js/25.25e30095.js"><link rel="prefetch" href="/assets/js/26.d7867109.js"><link rel="prefetch" href="/assets/js/27.fc8464e5.js"><link rel="prefetch" href="/assets/js/28.a821b188.js"><link rel="prefetch" href="/assets/js/29.1bebf4e2.js"><link rel="prefetch" href="/assets/js/3.391fe791.js"><link rel="prefetch" href="/assets/js/30.f2a2d9c6.js"><link rel="prefetch" href="/assets/js/31.e56495af.js"><link rel="prefetch" href="/assets/js/32.a346b474.js"><link rel="prefetch" href="/assets/js/33.ce475055.js"><link rel="prefetch" href="/assets/js/34.413e29a9.js"><link rel="prefetch" href="/assets/js/35.839fa239.js"><link rel="prefetch" href="/assets/js/36.4db4be0e.js"><link rel="prefetch" href="/assets/js/37.16727742.js"><link rel="prefetch" href="/assets/js/39.69f3981a.js"><link rel="prefetch" href="/assets/js/4.a04ccb9d.js"><link rel="prefetch" href="/assets/js/40.89464b71.js"><link rel="prefetch" href="/assets/js/41.3ffac7cc.js"><link rel="prefetch" href="/assets/js/42.48489876.js"><link rel="prefetch" href="/assets/js/43.9e42117c.js"><link rel="prefetch" href="/assets/js/44.f0191db4.js"><link rel="prefetch" href="/assets/js/45.b77db7cb.js"><link rel="prefetch" href="/assets/js/46.33739bdd.js"><link rel="prefetch" href="/assets/js/47.8bf52a09.js"><link rel="prefetch" href="/assets/js/48.3f9b93b9.js"><link rel="prefetch" href="/assets/js/5.4aba4ca2.js"><link rel="prefetch" href="/assets/js/6.c3403115.js"><link rel="prefetch" href="/assets/js/7.6acff8ff.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.aae61d50.js">
    <link rel="stylesheet" href="/assets/css/0.styles.d74e1dbf.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">OWASP-Application-Gateway</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/docs/" class="nav-link router-link-active">
  Documentation
</a></div><div class="nav-item"><a href="https://app.swaggerhub.com/apis-docs/gianlucafrei/OAG/0.4#/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Swagger
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://owasp.org/www-project-application-gateway/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  OWASP
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/The-OAG-Development-Project/Application-Gateway/" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/docs/" class="nav-link router-link-active">
  Documentation
</a></div><div class="nav-item"><a href="https://app.swaggerhub.com/apis-docs/gianlucafrei/OAG/0.4#/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Swagger
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://owasp.org/www-project-application-gateway/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  OWASP
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/The-OAG-Development-Project/Application-Gateway/" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Getting Started</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/" aria-current="page" class="sidebar-link">Introduction</a></li><li><a href="/docs/Terms-you-need-to-understand.html" class="sidebar-link">Terms you need to understand</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Configuration</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/Configuration.html" class="sidebar-link">Overview</a></li><li><a href="/docs/Configuration-File.html" class="sidebar-link">OAG Configuration File</a></li><li><a href="/docs/Configuration-Login-Providers.html" class="sidebar-link">Login Providers</a></li><li><a href="/docs/Configuration-Routes.html" class="sidebar-link">Routes</a></li><li><a href="/docs/Configuration-SecurityProfiles.html" class="sidebar-link">Security Profiles</a></li><li><a href="/docs/Configuration-Session-Behaviour.html" class="sidebar-link">Session Behaviour</a></li><li><a href="/docs/Tracing-Log-Correlation-Correlation-Logging.html" class="sidebar-link">Tracing, Log Correlation, Correlation Logging</a></li><li><a href="/docs/Configuration-User-Mapping.html" class="sidebar-link">User Mapping</a></li><li><a href="/docs/Key-management-and-JWT-signer.html" aria-current="page" class="active sidebar-link">Key management and JWT signer</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/Key-management-and-JWT-signer.html#key-management-configuration" class="sidebar-link">Key management configuration</a></li><li class="sidebar-sub-header"><a href="/docs/Key-management-and-JWT-signer.html#jwt-signer" class="sidebar-link">Jwt signer</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Custom code extensions</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>OAG API endpoints</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Integrating with OAG</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>How To's</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="key-management-and-jwt-signer"><a href="#key-management-and-jwt-signer" class="header-anchor">#</a> Key management and JWT signer</h1> <h2 id="key-management-configuration"><a href="#key-management-configuration" class="header-anchor">#</a> Key management configuration</h2> <p>This is a top level configuration element.</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">keyManagementProfile</span><span class="token punctuation">:</span>
  <span class="token key atrule">keyRotationProfile</span><span class="token punctuation">:</span>
    <span class="token key atrule">type</span><span class="token punctuation">:</span> defaultKeyRotation
    <span class="token key atrule">useSigningKeyRotation</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token key atrule">signingKeyRotationSeconds</span><span class="token punctuation">:</span> <span class="token number">28800</span>
    <span class="token key atrule">cleanupFrequencySeconds</span><span class="token punctuation">:</span> <span class="token number">10000</span>
  <span class="token key atrule">jwkStoreProfile</span><span class="token punctuation">:</span>
    <span class="token key atrule">type</span><span class="token punctuation">:</span> localRsaJwkStore
    <span class="token key atrule">implSpecificSettings</span><span class="token punctuation">:</span>
      <span class="token key atrule">exampleParameter</span><span class="token punctuation">:</span> <span class="token string">&quot;not used&quot;</span>
  <span class="token key atrule">keyGeneratorProfile</span><span class="token punctuation">:</span>
    <span class="token key atrule">type</span><span class="token punctuation">:</span> rsaKeyGenerator
    <span class="token key atrule">keySize</span><span class="token punctuation">:</span> <span class="token number">4096</span>
    <span class="token key atrule">implSpecificSettings</span><span class="token punctuation">:</span>
      <span class="token key atrule">exampleParameter</span><span class="token punctuation">:</span> <span class="token string">&quot;not used&quot;</span>
</code></pre></div><p><strong>keyRotationProfile part</strong></p> <ul><li><code>type</code>: Defines the key rotation strategy. Currently supported: 'defaultKeyRotation'.</li> <li><code>useSigningKeyRotation</code>: Set to true to automatically generate a new key from time to time (recommended). Set this to false to always keep the key generated at startup.</li> <li><code>signingKeyRotationSeconds</code>: Rotate the signing key after that many seconds.</li> <li><code>cleanupFrequencySeconds</code>: Run memory clean-up of expired signing keys after that many seconds. (Note that signing keys have a grace period during which they are still served when requested anyway built-in.)</li></ul> <p><strong>jwkStoreProfile part</strong></p> <ul><li><code>type</code>: Defines what type of keys the signing key store can hold. Currently supported: <code>localRsaJwkStore</code>.</li> <li><code>implSpecificSettings</code>: Key/value pairs required by the store implementation selected above. <code>localRsaJwkStore</code> needs none.</li></ul> <p><strong>keyGeneratorProfile part</strong></p> <ul><li><code>type</code>: The key generator to use. Currently supported: <code>rsaKeyGenerator</code>.</li> <li><code>keySize</code>: The number of bits for generated keys.</li> <li><code>implSpecificSettings</code>:  key generator impl specific settings. <code>rsaKeyGenerator</code> requires no additional settings.</li></ul> <h3 id="key-rotation-implementations"><a href="#key-rotation-implementations" class="header-anchor">#</a> key rotation implementations</h3> <h4 id="defaultkeyrotation"><a href="#defaultkeyrotation" class="header-anchor">#</a> <code>defaultKeyRotation</code></h4> <p>Implements a key rotation scheme that uses the configured keyGenerator to generate new keys and make them available in the configured jwkStore.
Makes sure that on startup a new signing key is generated.
Updates also the currentSigningKeyHolder with the new key. Heeds the standard configuration settings and does not require any <code>implSpecificSettings</code>.</p> <h3 id="jwkstore-implementations"><a href="#jwkstore-implementations" class="header-anchor">#</a> jwkStore implementations</h3> <h4 id="localrsajwkstore"><a href="#localrsajwkstore" class="header-anchor">#</a> <code>localRsaJwkStore</code></h4> <p>Stores signing keys as long as they are valid (plus a grace time of 10 minutes) in memory and local only.
Does not require any <code>implSpecificSettings</code>.</p> <h3 id="key-generator-implementations"><a href="#key-generator-implementations" class="header-anchor">#</a> key generator implementations</h3> <h4 id="rsakeygenerator"><a href="#rsakeygenerator" class="header-anchor">#</a> <code>rsaKeyGenerator</code></h4> <p>Generates RSA keys.
Does not require any <code>implSpecificSettings</code>.</p> <h2 id="jwt-signer"><a href="#jwt-signer" class="header-anchor">#</a> Jwt signer</h2> <p>The key signer used for a JWT passed to downstream system is configured in the security profile assigned to a route and only available for 'jwtToken'.</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">userMapping</span><span class="token punctuation">:</span>
      <span class="token key atrule">type</span><span class="token punctuation">:</span> <span class="token string">&quot;jwtToken&quot;</span>
      <span class="token key atrule">settings</span><span class="token punctuation">:</span>
        <span class="token comment"># ...</span>
        <span class="token key atrule">signatureImplementation</span><span class="token punctuation">:</span> <span class="token string">&quot;rsa&quot;</span>
        <span class="token key atrule">signatureSettings</span><span class="token punctuation">:</span>
</code></pre></div><p><strong>relevant settings part</strong></p> <ul><li><code>signatureImplementation</code>: The signature implementation to use. Currently supported: <code>rsa</code>, <code>hmac</code> (not recommended).</li> <li><code>signatureSettings</code>: signature implementation specific settings. <code>rsa</code> requires none.</li></ul> <h3 id="jwt-signers-signatureimplementation"><a href="#jwt-signers-signatureimplementation" class="header-anchor">#</a> jwt signers (<code>signatureImplementation</code>)</h3> <h4 id="rsa"><a href="#rsa" class="header-anchor">#</a> <code>rsa</code></h4> <p>Implements RS256 JWT signature based on automatically generated (zero-config) keys as implemented by the key rotation configuration.
Adds kid and jku headers to the JWT.
Does not need any configuration settings.</p> <h4 id="hmac-not-recommended"><a href="#hmac-not-recommended" class="header-anchor">#</a> <code>hmac</code> (not recommended)</h4> <p>Implements HS256, HS385, HS512 (derived  from key size) JWT signatures.
Adds kid header, but naturally no jku header to the JWT.
Requires these <code>signatureSettings</code>:</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token punctuation">...</span>
  <span class="token key atrule">signatureSettings</span><span class="token punctuation">:</span>
    <span class="token key atrule">keyId</span><span class="token punctuation">:</span> <span class="token string">&quot;myKeyId&quot;</span>
    <span class="token key atrule">secretKey</span><span class="token punctuation">:</span> <span class="token string">&quot;546573744b6579546573744b6579546573744b6579546573744b657....9&quot;</span>
</code></pre></div><p><strong>signatureSettings part</strong></p> <ul><li><code>keyId</code>: The kid to be put in the JWT header.</li> <li><code>secretKey</code>: The hey encoded shared key used for signing the JWT. Depending on its length HS256 (for 256-bit key), HS348 or HS512 is automatically used.</li></ul> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>Beware that the jwkStore, the keyGenerator as well as the jwtSigner used depend on each other! So if you use an RSA based JWT signer, you also need an RSA based jwkStore and keyGenerator. The keyRotation implementation is independent and relies on jwkStore and keyGenerator only.</p></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/docs/Configuration-User-Mapping.html" class="prev">
        User Mapping
      </a></span> <span class="next"><a href="/docs/Custom-(code)-extensions.html">
        Overview
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.80938ac1.js" defer></script><script src="/assets/js/2.699db687.js" defer></script><script src="/assets/js/1.6f7f3e11.js" defer></script><script src="/assets/js/38.a0654948.js" defer></script>
  </body>
</html>
